<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análise Detalhada da Votação - Segundo Turno</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f8ff;
            color: #00008b;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1, h2 {
            text-align: center;
            color: #0000cd;
        }
        .analise {
            background-color: #ffffff;
            border: 2px solid #0000cd;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        .graficos {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
        }
        .grafico {
            width: 45%;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Análise Detalhada da Votação - Segundo Turno</h1>
        
        <div class="analise">
            <h2>Gráficos e Estatísticas</h2>
            <div class="graficos" id="graficosContainer"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCF50W92_ZmSLGcDLlOr8r7QtF__JchP50",
            authDomain: "webuserdata.firebaseapp.com",
            databaseURL: "https://webuserdata-default-rtdb.firebaseio.com",
            projectId: "webuserdata",
            storageBucket: "webuserdata.appspot.com",
            messagingSenderId: "996591404387",
            appId: "1:996591404387:web:0d2f5d16b9494de4997f56",
            measurementId: "G-VTDKLXL5TS"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        const votosRef = ref(database, 'votos');
        onValue(votosRef, (snapshot) => {
            const votos = snapshot.val();
            criarGraficos(votos);
        });

        function criarGraficos(votos) {
            const graficosContainer = document.getElementById('graficosContainer');
            graficosContainer.innerHTML = '';

            // Gráfico 1: Votos por candidato
            criarGrafico('Votos por Candidato', 'pie', contarVotosPorCandidato(votos));

            // Gráfico 2: Votos por seção
            criarGrafico('Votos por Seção', 'bar', contarVotosPorSecao(votos));

            // Gráfico 3: Evolução dos votos ao longo do tempo
            criarGrafico('Evolução dos Votos', 'line', evolucaoVotos(votos));

            // Gráfico 4: Distribuição de votos por hora do dia
            criarGrafico('Distribuição de Votos por Hora', 'bar', distribuicaoVotosPorHora(votos));

            // Adicione mais gráficos aqui...
        }

        function criarGrafico(titulo, tipo, dados) {
            const graficoDiv = document.createElement('div');
            graficoDiv.className = 'grafico';
            const canvas = document.createElement('canvas');
            graficoDiv.appendChild(canvas);
            document.getElementById('graficosContainer').appendChild(graficoDiv);

            new Chart(canvas, {
                type: tipo,
                data: dados,
                options: {
                    responsive: true,
                    title: {
                        display: true,
                        text: titulo
                    }
                }
            });
        }

        function contarVotosPorCandidato(votos) {
            const contagem = { "Francisco Luciano": 0, "Miguel": 0 };
            for (const key in votos) {
                contagem[votos[key].candidato]++;
            
            }
            return {
                labels: Object.keys(contagem),
                datasets: [{
                    data: Object.values(contagem),
                    backgroundColor: ['#0000cd', '#00008b']
                }]
            };
        }

        function contarVotosPorSecao(votos) {
            const contagem = {};
            for (const key in votos) {
                const secao = votos[key].secao;
                contagem[secao] = (contagem[secao] || 0) + 1;
            }
            return {
                labels: Object.keys(contagem),
                datasets: [{
                    label: 'Votos',
                    data: Object.values(contagem),
                    backgroundColor: '#0000cd'
                }]
            };
        }

        function evolucaoVotos(votos) {
            const evolucao = {};
            for (const key in votos) {
                const data = new Date(votos[key].timestamp);
                const dataFormatada = `${data.getDate()}/${data.getMonth() + 1}`;
                evolucao[dataFormatada] = (evolucao[dataFormatada] || 0) + 1;
            }
            return {
                labels: Object.keys(evolucao),
                datasets: [{
                    label: 'Votos',
                    data: Object.values(evolucao),
                    borderColor: '#0000cd',
                    fill: false
                }]
            };
        }

        function distribuicaoVotosPorHora(votos) {
            const distribuicao = {};
            for (const key in votos) {
                const hora = new Date(votos[key].timestamp).getHours();
                distribuicao[hora] = (distribuicao[hora] || 0) + 1;
            }
            return {
                labels: Object.keys(distribuicao),
                datasets: [{
                    label: 'Votos',
                    data: Object.values(distribuicao),
                    backgroundColor: '#0000cd'
                }]
            };
        }
    </script>
</body>
</html>
